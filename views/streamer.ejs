<head>
    <%- include('./partials/adheaders'); %>
    <link rel="stylesheet" href="https://cdn.plyr.io/1.8.2/plyr.css">
    <script src="https://cdn.plyr.io/1.8.2/plyr.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/hls.js/latest/hls.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
</head>
<%- include('./partials/header'); %>
<%- include('./partials/messages'); %>
<style>
    .profile-pic {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: contain;
        margin-top: 4px;
    }
</style>
<div style="margin: 50px;">
</div>
    <body>
        <div class="container">
            <div class="row">
                <div class="ccol-12 col-md-8">
                    <div>
                        <div style="display: inline-block;" id="livestatus"><%- livestatus %></div>
                        <div style="display: inline-block;">---</div>
                        <div style="display: inline-block;" id="liveviewers"><p style="color: darkorange;"><%= liveviewers %></p></div>
                        <div style="display: inline-block;"><p style="color: darkorange;">Viewers</p></div>
                        <div style="display: inline-block;">---</div>
                        <div style="display: inline-block;"><p style="color: rgb(255, 0, 179);">Followers: </p></div>
                        <div style="display: inline-block;"><p style="color: yellow;"><%= followercount %></p></div>
                    </div>
                    <div style="display: block;">
                        <video preload="none" id="player" autoplay controls crossorigin></video>
                    </div>
                    <div style="margin-top: 4px;">
                        <div class="row px-3"> <img src="<%= avatarurl %>" class="rounded-circle profile-pic mr-3" alt="profile picture"> 
                            <div class="flex-column" style="margin-bottom: 0px; margin-left: 10px;">
                                <div class="row">
                                    <h3 style="color: white; font-size: 25px;" class="lead mb-3">
                                        <%= streamtitle %>
                                    </h3>
                                </div>
                                <div class="row">
                                    <p id="username_field" style="color: lime; font-size: 15px; margin-right: 4px;" class="lead mb-3"><%= user %></p>
                                    <%- badge %>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-left: 5px;" class="row">
                        <%- followbutton %>
                        <form style="margin: 10px;" action="<%= donationlink %>">
                            <button type="submit" class="btn btn-primary">Donate</button>
                        </form>
                    </div>
                    <div style="margin-top: 15px; margin-left: 5px; margin-right: 5px;">
                        <p style="color: white; font-size: 15px;" class="lead mb-3">
                            <%= streamdescription %>
                        </p>
                    </div>
                    <%- include('./partials/googlead'); %>
                </div>
                <div class="col-6 col-md-4" style="color: white;">
                    Chat is still WIP 
                </div>
            </div>
        </div>
        </div>
        <script id="erasable">
            var alreadyLive = false
            axios.get('https://cdn.throwdown.tv/api/streams/<%= user %>')
                .then(function (response){
                    document.getElementById('liveviewers').innerHTML = `<p style="color: darkorange;">${response.data.viewers}</p>`;
                    if (response.data.isLive === true) {
                        if (alreadyLive === false) {
                            alreadyLive = true
                        }
                    } else {
                        alreadyLive = false
                    }
                })
            var video = document.querySelector('#player');
            if (Hls.isSupported()) {
                var hls = new Hls();
                hls.loadSource('<%= streamlink %>');
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED,function() {
                    video.play();
                });
            }
            plyr.setup(video);
            setInterval(function(){
            axios.get('https://cdn.throwdown.tv/api/streams/<%= user %>')
                .then(function (response){
                    document.getElementById('liveviewers').innerHTML = `<p style="color: darkorange;">${response.data.viewers}</p>`;
                    if (response.data.isLive === false) {
                        if (alreadyLive === true) {
                            document.getElementById('livestatus').innerHTML = `<p style="color: red;">OFFLINE</p>`
                            alreadyLive = false;
                            window.location.reload(true);
                        }
                    } else {
                        if (alreadyLive === false) {
                            document.getElementById('livestatus').innerHTML = `<p style="color: lime;">ONLINE</p>`
                            alreadyLive = true;
                            setTimeout(function(){
                                window.location.reload(true);
                            }, 2000)
                        }
                    }
                    if (response.data.banned === true) {
                        window.location.reload(true);
                    }
                })
            }, 10000)
        </script>
    </body>